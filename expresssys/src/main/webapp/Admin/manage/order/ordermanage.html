<meta charset="UTF-8" >

<table id="orders_manager" data-options="fit:true"></table>
<div id="orders_search">
	<a id="btn" href="javascript:orders_showAddorders()" class="easyui-linkbutton" data-options="iconCls:'icon-script-add',plain:true" style="float:left">添加</a>  
	<div class="datagrid-btn-separator"></div>
	<a id="btn" href="javascript:orders_showUpdateorders()" class="easyui-linkbutton" data-options="iconCls:'icon-server-edit',plain:true" style="float:left">修改</a>  
	<div class="datagrid-btn-separator"></div>
	
	<label>订单编号：</label>
	<input type="text" name="osid" id="orders_search_osid"/>
	
	<label>所属单位：</label>
	<select name="spid" id="orders_search_spid">
		<option value="">--全部--</option>
	</select>
	
	<label>快递类型：</label>
	<select  name="otype" id="orders_search_otype" >
				<option value="">--全部--</option>
				<option value="0">快件</option>
				<option value="1">慢件</option>
				<option value="2">大件</option>
	</select>
	<a href="javascript:orders_searchorders()" class="easyui-linkbutton" data-options="iconCls:'icon-search'">查询</a>
</div>
<div id="orders_update" class="easyui-dialog" title="添加配送点信息" style="width:600px;height:400px;align:center"
		data-options="iconCls:'icon-user-add',resizable:true,modal:true,closed:true" >
	<form id="orders_update_orders">
		<ul>
		
			<li>
				<input type="hidden" name="osid" id="orders_update_osid" value="">
				<label>寄件人姓名：</label>
				<input type="text" name="osendname" id="orders_update_osendname" class="orders_input"/>
			
				<label>寄件人电话：</label>
				<input type="text" name="osendtel" id="orders_update_osendtel" class="orders_input"/>
			</li>
			<li>
				<label>寄件人地址：</label>
				<input type="text" name="osendaddress" id="orders_update_osendaddress" class="orders_input2"/>
			</li>
			<li>
				<label>收件人姓名：</label>
				<input type="text" name="orecname" id="orders_update_orecname" class="orders_input"/>
			
				<label>收件人电话：</label>
				<input type="text" name="orectel" id="orders_update_orectel" class="orders_input"/>
				
			</li>
			<li>
			<label>收件人邮编：</label>
				<input type="text" name="oreccode" id="orders_update_oreccode" class="orders_input"/>
			
				<label>收件人地址：</label>
				<input type="text" name="orecaddress" id="orders_update_orecaddress" class="orders_input2"/>
			</li>
			
			<li>
				<label>订单日期：</label>
				<input type="text" name="otime" id="orders_update_otime"  class="easyui-datebox" />
			</li>
			<li>
				<label>配送费：</label>
				<input type="text" name="oprice" id="orders_update_oprice" class="orders_input" />
			
				<label>保价金额：</label>
				<input type="text" name="oinsureprice" id="orders_update_oinsureprice" class="orders_input"/>
			</li>
			<li>
				<label>订单类型：</label>
				<select  name="otype" id="orders_update_otype" >
				<option value="0">快件</option>
				<option value="1">慢件</option>
				<option value="2">大件</option>
				
				</select>
				<label>所属单位：</label>
				<select name="spid" id="orders_update_spid" >
				</select>
			</li>
			<li>
				<label>要求启程时间：</label>
				<input type="text" name="ostarttime" id="orders_update_ostarttime"  class="easyui-datebox" />
			
				<label>要求到达时间：</label>
				<input type="text" name="oendtime" id="orders_update_oendtime"  class="easyui-datebox" />
			</li>
			
			
			<li>
				<label>备注：</label>
				<textarea  rows="5" cols="20"  id="orders_update_oremark" >
				</textarea>
			</li>
			
			
		</ul>
		
	</form>
</div>
<style>
#orders_search label{
	margin-left:20px;
	width:30px;
}

#orders_update li{
	list-style-type:none;
	margin-top:20px;
}

#orders_update .orders_input{
	width:100px;
	border:1px solid #95B8E7;
	line-height:20px;
}
#orders_update .orders_input2{
	width:200px;
	border:1px solid #95B8E7;
	line-height:20px;
}

.orders_delpic_show{
	width:100px;
	height:100px;
	overflow:hidden;
	position:relative;
	float:left;
	border:1px solid #fff;
}

.orders_delpic_show>span{
	margin:0px;
	padding:0px;
	background:url(../../images/cancel.png) no-repeat; center center;
	width:16px;
	height:16px;
	display:none;
	position:absolute;
	top:2px;
	right:2px;
}

.orders_delpic_show:hover{
	border-color:#f63;
}

.orders_delpic_show:hover span{
	display:block;
	cursor:orderser;
}

.orders_delsaddr_show{
	width:300px;
	height:30px;
	overflow:hidden;
	position:relative;
	float:left;
	border:1px solid #fff;
}
.orders_delsaddr_show>span{
	margin:0px;
	padding:0px;
	background:url(../../images/cancel.png) no-repeat; center center;
	width:16px;
	height:16px;
	display:none;
	position:absolute;
	top:2px;
	right:2px;
}
.orders_delsaddr_show:hover{
	border-color:#f63;
}

.orders_delsaddr_show:hover span{
	display:block;
	cursor:orderser;
}
</style>
<script type="text/javascript">
var ordersEditRow=undefined;
var ordersObject;
var ordersFlag;
var ordersmark="";
var shippointList;
$(function(){
	var shippointStr="";
	var shippointTypeStr="";
	$.get("point/findAll.action",{rows:20,page:1},function(data){
		var str="";
	
		shippointList=data.rows;
		
		$.each(shippointList,function(index,item){
			shippointStr+="<option value='"+item.spid+"'>"+item.spname+"</option>";
		});
		$("#orders_search_spid").append($(shippointStr));
		$("#orders_update_spid").append($(shippointStr));
		
		ordersObject = $('#orders_manager').datagrid({
			url : "orders/findAll.action",
			fitColumns : true,
			striped : true,//������ʾ�б���
			loadMsg : '数据加载中...',
			rownumbers : true,
			pagination : true,
			pageNumber : 1,
			pageSize : 10,
			pageList : [  10, 20, 30, 40, 50 ],
			sortName:'osid',//������һ��������
			remoteSort:false,
			columns:[[   
			        {checkbox:true},      
			        {field:'osid',title:'配送id',width:100,align:'center',sortable:true},   
			        {field:'osendname',title:'寄件人姓名',width:100,align:'center'},   
			        {field:'osendtel',title:'联系人',width:100,align:'center'},
			        {field:'osendaddress',title:'寄件人地址',width:100,align:'center',sortable:true},   
			        {field:'orectel',title:'收件人电话ַ',width:100,align:'center'},
			        {field:'orecaddress',title:'收件人地址',width:100,align:'center'}, 
			        {field:'ostatus',title:'订单状态',width:100,align:'center',formatter:function(val,row,index){
			        	if(val==0){
			        		return '未发件';
			        	} else if(val==1){
			        		return '已发件';
			        	}   else if(val==3){
			        		return '已送达';
			        	}
			        }}, 
			        
			        {field:'_operate',title:'操作',width:100,align:'center',formatter:function(val,row,index){
			        	return "<a href='javascript:orders_findorders("+row.osid+")'> 详情</a><a href='javascript:orders_delorders("+row.osid+")'> 删除</a>"  //配送点详情查看
			        }}
			    ]],
			    toolbar:"#orders_search"
	
	
		});
	},"json");
	
});	
	
	function orders_showAddorders(){
		$("#orders_update_orders")[0].reset();
		$('#orders_update').dialog({
			title:"添加配送点信息",
			iconCls:'icon-user-add',
			buttons:[{
				text:'确定',
				iconCls:'icon-user-add',
				handler:function(){
				
					
					$.ajax({
						url:"orders/add.action",
						secureuri:false,
						type : "POST",
						dataType:"text",
						data:$("#orders_update_orders").serialize(),
						success:function(data,status){
							console.info(data);
							if(data>0){
								ordersObject.datagrid("reload");
								$("#orders_update_orders")[0].reset();
								$.messager.show({title:"成功提示",msg:"配送点信息添加成功...",timeout:2000,showType:"slide"});
								$('#orders_update').dialog("close");
							}else{
								$.messager.alert("失败提示","配送点信息添加失败...","error");
							}
							
						},
						error:function(data,status,e){
							$.messager.alert("失败提示","配送点信息添加失败...\n"+e,"error");
						}
					});
				}
			}]
		});
		$('#orders_update').dialog("open");
	}
	
	function orders_showUpdateorders(){
		$("#orders_update_orders")[0].reset();
		var rows=$('#orders_manager').datagrid("getChecked");
		if(rows.length<=0){
			$.messager.show({title:"温馨提示",msg:"请选择您要修改的配送点信息...",timeout:2000,showType:"slide"});
		}else{
			var row=rows[0];
			var osid=row.osid;
			$.post("orders/findByID.action",{osid:osid},function(data){
				$("#orders_update_osid").val(osid);
				ordersmark=data.rows[0].spremark;
				$("#orders_update_osendname").val(data.rows[0].osendname);
				$("#orders_update_osendtel").val(data.rows[0].osendtel);
				$("#orders_update_osendaddress").val(data.rows[0].osendaddress);
				$("#orders_update_orecname").val(data.rows[0].orecname);
				$("#orders_update_orectel").val(data.rows[0].orectel);
				$("#orders_update_orecaddress").val(data.rows[0].orecaddress);
				$("#orders_update_oreccode").val(data.rows[0].oreccode);
				$("#orders_update_otime").datebox('setValue',data.rows[0].otimeString);
				
				$("#orders_update_oprice").val(data.rows[0].oprice);
				$("#orders_update_oinsureprice").val(data.rows[0].oinsureprice);
				$("#orders_update_otype").val(data.rows[0].otype);
				$("#orders_update_ostarttime").datebox('setValue',data.rows[0].ostarttimeString);
				$("#orders_update_oendtime").datebox('setValue',data.rows[0].oendtimeString);
				$("#orders_update_spid").val(data.rows[0].spid);
				$("#orders_update_usid").val(data.rows[0].usid);
				$("#orders_update_oremark").val(data.rows[0].oremark);
				
			})
			
		$('#orders_update').dialog({
			title:"修改配送点信息",
			iconCls:'icon-user-edit',
			buttons:[{
				text:'修改',
				iconCls:'icon-user-edit',
				handler:function(){
					
					$.ajax({
						url:"orders/update.action",
						secureuri:false,
						type : "POST",
						dataType:"text",
						data:$("#orders_update_orders").serialize(),
						success:function(data,status){
							data=parseInt($.trim(data));
							if(data>0){
								$.messager.show({title:"成功提示",msg:"配送点信息修改成功...",timeout:2000,showType:"slide"});
								$('#orders_update').dialog("close");
								ordersObject.datagrid("reload");
							}else{
								$.messager.alert("失败提示","配送点信息修改失败...","error");
							}
							
						},
						error:function(data,status,e){
							$.messager.alert("失败提示","配送点信息添加失败...\n"+e,"error");
						}
					});
				
				}
			}]
		})
		$('#orders_update').dialog("open");
		}
	}


	//删除配送点
	function orders_delorders(osid){
		$.post("orders/delete.action",{osid:osid},function(data){
			data=parseInt($.trim(data));
			if(data>0){
				$.messager.show({title:"成功提示",msg:"配送点信息删除成功...",timeout:2000,showType:"slide"});
				ordersObject.datagrid("reload");
			}else{
				$.messager.alert("失败提示","配送点信息删除失败...","error");
				ordersObject.datagrid("reload");
			}
		})
	}

	//详情查询
	function orders_findorders(osid){

		$("#orders_update_orders")[0].reset();
		var rows=$('#orders_manager').datagrid("getChecked");
		if(rows.length<=0){
			$.messager.show({title:"温馨提示",msg:"请选择您要修改的配送点信息...",timeout:2000,showType:"slide"});
		}else{
			var row=rows[0];
			var osid=row.osid;
			$.post("orders/findByID.action",{osid:osid},function(data){
				$("#orders_update_osid").val(osid);
				ordersmark=data.rows[0].spremark;
				$("#orders_update_osendname").val(data.rows[0].osendname);
				$("#orders_update_osendtel").val(data.rows[0].osendtel);
				$("#orders_update_osendaddress").val(data.rows[0].osendaddress);
				$("#orders_update_orecname").val(data.rows[0].orecname);
				$("#orders_update_orectel").val(data.rows[0].orectel);
				$("#orders_update_orecaddress").val(data.rows[0].orecaddress);
				$("#orders_update_oreccode").val(data.rows[0].oreccode);
				$("#orders_update_otime").datebox('setValue',data.rows[0].otimeString);
				
				$("#orders_update_oprice").val(data.rows[0].oprice);
				$("#orders_update_oinsureprice").val(data.rows[0].oinsureprice);
				$("#orders_update_otype").val(data.rows[0].otype);
				$("#orders_update_ostarttime").datebox('setValue',data.rows[0].ostarttimeString);
				$("#orders_update_oendtime").datebox('setValue',data.rows[0].oendtimeString);
				$("#orders_update_spid").val(data.rows[0].spid);
				$("#orders_update_usid").val(data.rows[0].usid);
				$("#orders_update_oremark").val(data.rows[0].oremark);
				
			})
			
		$('#orders_update').dialog({
			title:"查看配送点信息",
			iconCls:'icon-user-edit',
			buttons:[{
				text:'确定',
				iconCls:'icon-user-edit',
				handler:function(){
					$('#orders_update').dialog("close");
				}
			}]
		})
		$('#orders_update').dialog("open");
		}
	}
	
	//条件查询
	function orders_searchorders(){
		var otype=$.trim( $("#orders_search_otype").val() );
		var spid=$.trim( $("#orders_search_spid").val() );
		var osid=$.trim( $("#orders_search_osid").val() );
		$('#orders_manager').datagrid({
			url:"orders/findByCondition.action",
			queryParams:{otype:otype,spid:spid,osid:osid}
		});
		
		$("#orders_search_otype").val("");
		 $("#orders_search_spid").val("");
	}


</script>



<meta charset="UTF-8">
