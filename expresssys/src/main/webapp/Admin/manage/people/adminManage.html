<meta charset="UTF-8">
<table id="user_data" data-options="fit:true"></table>

<script type="text/javascript">
var adminEditRow=undefined;
var adminOp;
var adminFlag;
var adminObject=$('#user_data').datagrid({   
    url:'findAll.action',
    fitColumns:true,
    pagination:true,	//设置true将在数据表格底部显示分页工具栏。
    striped:true,	//交替显示行背景
    loadMesg:'数据加载中',
    rownumbers:true,
    pageNumber:1,
    pageSize:5,
    pageList:[5,10,20,30,40,50],
    sortName:'aid',
    remoteSort:false,	//升序降序排列
    columns:[[   
        {checkbox:true},
        {field:'usId',title:'管理员编号',width:100,align:'center',sortable:true},   
        {field:'uname',title:'管理员姓名',width:100,align:'center',editor:{type:"text",options:{required:true}}},   
        {field:'upwd',title:'管理员密码',width:100,align:'center',editor:{type:"text",options:{required:true}}},
        {field:'urealName',title:'真实姓名',width:100,align:'center',editor:{type:"text",options:{required:true}}},
        {field:'uaddress',title:'地址',width:100,align:'center',editor:{type:"text",options:{required:true}}},   
        {field:'uphone',title:'手机',width:100,align:'center',editor:{type:"text",options:{required:true}}},
        {field:'utel',title:'电话',width:100,align:'center',editor:{type:"text",options:{required:true}}},
        {field:'uemail',title:'邮箱',width:100,align:'center',editor:{type:"text",options:{required:true}}}
    ]],
    toolbar: [{
    	text:"添加",
		iconCls: 'icon-user-add',	//图片的加载
		handler: function(){
			if(adminEditRow==undefined){
				//在表格最前面添加一行
				adminObject.datagrid('insertRow',{index:0,row:{}});
				adminObject.datagrid('beginEdit',0);		//开始编辑第一行
				adminEditRow=0;	//记录当前正在被编辑的行的索引
				adminOp="addAdmin";
				adminFlag="添加";
			}
		}
	},'-',{
		text:"修改",
		iconCls: 'icon-user-edit',
		handler: function(){
			if(adminEditRow!=undefined){
				adminObject.datagrid("rejectChanges");	//回滚数据
				adminEditRow=undefined;
			}
			
			var row=adminObject.datagrid("getChecked")[0];	//选中的行数
			if(row==undefined){
				$.messager.show({title:'温馨提示',msg:'请选择您要修改的数据...',timeout:2000,showType:'slide'});
			}else{
				adminEditRow=adminObject.datagrid("getRowIndex",row);
				adminObject.datagrid('beginEdit',adminEditRow);
				adminOp="updateAdmin";
				adminFlag="修改";
			}
		}
	},'-',{
		text:"删除",
		iconCls: 'icon-user-delete',
		handler: function(){
			var rows=adminObject.datagrid("getChecked");	//选中的行数
			if(rows.length<0){
				$.messager.show({title:'温馨提示',msg:'请选择您要删除的行...',timeout:2000,showType:'slide'});
			}else{
				$.messager.confirm('温馨提示','数据一旦删除将不能恢复，您确定要删除?',function(r){   
				    if (r){   
				    	var deptnos="";
				    	for(var i=0,len=rows.length;i<len-1;i++){
				    		deptnos+=rows[i].deptno+",";
				    	}
				    	deptnos+=rows[i].deptno;
				    	$.post("../../adminServlet",{op:"delAdmin",deptno:deptnos},function(data){
							data=parseInt( $.trim(data) );
							if(data>0){
								$.messager.show({title:'温馨提示',msg:'管理员信息删除成功...',timeout:2000,showType:'slide'});
								adminObject.datagrid("reload");	//自动更新
							}else{
								$.messager.alert('失败提示','管理员信息删除失败','error');
							}
						},"text")
				    }else{
				    	return;
				    }   
				}); 
			}
		}
	},'-',{
		text:"保存",
		iconCls: 'icon-user-tick',
		handler: function(){
			//先结束当前正在被编辑的行,保证每次只能添加一行
			if(adminEditRow!=undefined){		//说明有正在被编辑的行	
				adminObject.datagrid("endEdit",adminEditRow);		//结束编辑，返回类型是一个索引
				adminEditRow=undefined;
			}
			var row=adminObject.datagrid("getChanges")[0];	//getChanges的返回值为type，获取改变数据时所有属性
			if(row==undefined){	//说明没有修改数据，则提示
				$.messager.show({title:'温馨提示',msg:'请选择或编辑您要'+adminFlag+'的数据...',timeout:2000,showType:'slide'});
			}else{
				row["op"]=adminOp;	//添加一个属性
				$.post("../../adminServlet",row,function(data){
					data=parseInt( $.trim(data) );
					if(data>0){
						$.messager.show({title:'温馨提示',msg:'管理员信息'+adminFlag+'成功...',timeout:2000,showType:'slide'});
						adminObject.datagrid("reload");	//自动更新
					}else{
						$.messager.alert('失败提示','管理员信息'+adminFlag+'失败','error');
						adminObject.datagrid("reload");	//自动更新
					}
				},"text")
			}
		}
	},'-',{
		text:"撤销",
		iconCls: 'icon-edit',
		handler: function(){
				 
		}
	}]

    
    
   
});  
</script>