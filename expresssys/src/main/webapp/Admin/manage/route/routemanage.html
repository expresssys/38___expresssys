<meta charset="UTF-8">
<table id="table_route_manager" data-options="fit:true" ></table>
<div id="route_search">
	<a id="btn" href="javascript:route_showAddroute()" class="easyui-linkbutton" data-options="iconCls:'icon-script-add',plain:true" style="float:left">添加</a>  
	<div class="datagrid-btn-separator"></div>
	<a id="btn" href="javascript:route_showUpdateroute()" class="easyui-linkbutton" data-options="iconCls:'icon-server-edit',plain:true" style="float:left">修改</a>  
	<div class="datagrid-btn-separator"></div>
	
	<label>路线名称：</label>
	<input type="text" name="rname" id="route_search_rname"/>
	<a href="javascript:route_searchroute()" class="easyui-linkbutton" data-options="iconCls:'icon-search'">查询</a>
</div>
<div id="route_update" class="easyui-dialog" title="添加路线信息" style="width:400px;height:500px;align:center"
		data-options="iconCls:'icon-user-add',resizable:true,modal:true,closed:true" >
	<form id="form_route_update">
		<input type="hidden"  name="rid" id="route_update_rid"  />
		<ul>
			<li>
				<label>路线名称<span></span></label>
				<input type="text" name="rname" id="route_update_rname" class="route_input"/>
			</li>
			<li>
				<label>路线数量<span></span></label>
				<input type="text" name="gcount" id="route_update_gcount" class="route_input"/>
			</li>
		</ul>
	</form>
</div>

<div id="route_show" class="easyui-dialog" title="查看路线信息" style="width:400px;height:500px;align:center"
		data-options="iconCls:'icon-user-add',resizable:true,modal:true,closed:true" >
	<form id="form_route_show">
		<ul>
			<li>
				<label>路线名称：<span></span></label>
				<label id="route_show_rname" class="label" ></label>
			</li>
			<li>
				<label>路线站点：<span></span></label>
				<label  id="route_show_gcount" class="label"  ></label>
			</li>
			
		</ul>
	</form>
</div>

<style>

#route_search label{
	margin-left:20px;
}

#route_update label{
	display:inroute-block;
	width:66px;	
	text-align:justify;
	margin-top: 15px;
	margin-right: 10px;
	margin-left:10px;
}
#route_update label span{
  display:inroute-block;
  width:100%;
}

#route_update li{
	list-style-type:none;
}

#route_update .route_input{
	width:160px;
	border:1px solid #95B8E7;
	route-height:20px;
}

#route_show label{
	display:inroute-block;
	width:66px;	
	text-align:justify;
	margin-top: 15px;
	margin-right: 10px;
	margin-left:10px;
}
#route_show ul .label{
	margin-top:3px;
}
#route_show label span{
  display:inroute-block;
  width:100%;
}

#route_show li{
	list-style-type:none;
}

</style>

<script type="text/javascript">
var routeEditRow = undefined;
var dataSelect =[{"status":"已签收"},{"status":"等待揽件"},{"status":"已发货"},{"status":"运输中"},{"status":"派送中"}];

var routeObject=$('#table_route_manager').datagrid({   
    url:'route/find.action',
    fitColumns:true,
    pagination:true,	//设置true将在数据表格底部显示分页工具栏。
    striped:true,	//交替显示行背景
    loadMesg:'数据加载中',
    rownumbers:true,
    pageNumber:1,
    pageSize:50,
    pageList:[10,20,40,50,100],
    sortName:'rid',
    remoteSort:false,	//升序降序排列
    columns:[[   
			{checkbox:true},  
	        {field:'rid',title:'路线编号',width:100,align:'center',sortable:true},   
	        {field:'rname',title:'路线名称',width:100,align:'center'},   
	        
        ]],
        toolbar:"#route_search"
}); 

function route_showAddroute(){
	$("#form_route_update")[0].reset();
	$('#route_update').dialog({
		title:"添加路线信息",
		iconCls:'icon-user-add',
		buttons:[{
			text:'确定',
			iconCls:'icon-user-add',
			handler:function(){
				var gname=$.trim( $("#route_update_gname").val() );
				var gtype=$.trim( $("#route_update_gtype").val() );
				var res1=$.trim( $("#route_update_res1").val() );
				
				if(gname=="" || gtype=="" || res1==-1){
					alert("请填入完整信息");
					return ;
				}
				
				$.ajax({
					url:"route/add.action",
					secureuri:false,
					type:"POST",
					data: $('#form_route_update').serialize(),  
					success:function(data,status){
						if(data.code>0){
							routeObject.datagrid("reload");
							$("#form_route_update")[0].reset();
							$.messager.show({title:"成功提示",msg:"路线信息添加成功...",timeout:2000,showType:"slide"});
							$('#route_update').dialog("close");
						}else{
							$.messager.alert("失败提示","路线信息添加失败...","error");
						}
					},
					error:function(data,status,e){
						$.messager.alert("失败提示","路线员信息添加失败...\n"+e,"error");
					}
				});
			}
		}]
	});
	$('#route_update').dialog("open");
}

//修改
function route_showUpdateroute(){
	var rows=$('#table_route_manager').datagrid("getChecked");
	
	if(rows.length<=0){
		$.messager.show({title:"温馨提示",msg:"请选择您要修改的路线信息...",timeout:2000,showType:"slide"});
	}else{
		var row = rows[0];
		
		$("#route_update_gname").val(row.gname);
		$("#route_update_gcount").val(row.gcount);
		$("#route_update_gunit").val(row.gunit);
		$("#route_update_gprice").val(row.gprice);
		$("#route_update_gweight").val(row.gweight);
		$("#route_update_gvolume").val(row.gvolume);
		$("#route_update_gtype").val(row.gtype);
		$("#route_update_gremark").val(row.gremark);
		$("#route_update_rid").val(row.rid);
		$("#route_update_res1").val(row.res1);
		
		
		$('#route_update').dialog({
			title:"修改路线信息",
			iconCls:'icon-user-add',
			buttons:[{
				text:'确定',
				iconCls:'icon-user-add',
				handler:function(){
					var gname=$.trim( $("#route_update_gname").val() );
					var gtype=$.trim( $("#route_update_gtype").val() );
					
					if(gname=="" || gtype==""){
						alert("请填入完整的修改信息");
						return ;
					}
					
					$.ajax({
						url:"route/update.action",
						secureuri:false,
						type:"POST",
						data: $('#form_route_update').serialize(),  
						success:function(data,status){
							if(data.code>0){
								routeObject.datagrid("reload");
								$("#form_route_update")[0].reset();
								$.messager.show({title:"成功提示",msg:"路线信息修改成功...",timeout:2000,showType:"slide"});
								$('#route_update').dialog("close");
							}else{
								$.messager.alert("失败提示","路线信息修改失败...","error");
							}
						},
						error:function(data,status,e){
							$.messager.alert("失败提示","路线员信息修改失败...\n"+e,"error");
						}
					});
				}
			}]
		});
		$('#route_update').dialog("open");
	}
}

//条件查询
function route_searchroute(){
	var gname = $.trim( $("#route_search_gname").val() );
	var gtype=$.trim( $("#route_search_gtype").val() );
	var res1=$.trim( $("#route_search_res1").val() );
	
	if(res1==-1){
		res1='';
	}	
	
	$('#table_route_manager').datagrid({
		url:"route/find.action",
		queryParams:{gname:gname,gtype:gtype,res1:res1}
	});
}

//路线状态修改
function users_update_ustatus(rid){
	$.post("route/update.action",{rid:rid},function(data){
		if(data.code>0){
			$.messager.show({title:"成功提示",msg:"该路线状态已修改",timeout:2000,showType:"slide"});
			usersObject.datagrid("reload");
		}else{
			$.messager.alert("失败提示","该路线状态修改失败...","error");
			usersObject.datagrid("reload");
		}
	})
}


    /* $("#table_route_manager").datagrid({  
        //双击事件  
        onDblClickRow: function (index, row) {  
                if(routeEditRow!=undefined){
                	routeObject.datagrid('rejectChanges');//结束编辑
                	routeEditRow=undefined;
                }
                if(row==undefined){
					$.messager.show({title:'温馨提示',msg:'请选择或编辑您要修改的数据',timeout:2000,showType:'slide'});
				}else{
					routeEditRow = routeObject.datagrid('getRowIndex',row);
					routeObject.datagrid("beginEdit",routeEditRow);
					
				}
        }
    });   */

    
    function route_show(rid){
    	
    	$.post("route/find.action",{rid:rid,page:1,rows:1},function(data){
    		if(data.total>0){
    			$("#route_show_gname").html(data.rows[0].gname);
    			$("#route_show_gcount").html(data.rows[0].gcount + " " + data.rows[0].gunit);
    			$("#route_show_gprice").html(data.rows[0].gprice);
    			$("#route_show_gweight").html(data.rows[0].gweight+" kg");
    			$("#route_show_gvolume").html(data.rows[0].gvolume + " m³");
    			$("#route_show_gtype").html(data.rows[0].gtype);
    			$("#route_show_gremark").html(data.rows[0].gremark);
    			$("#route_show_res1").html(dataSelect[data.rows[0].res1].status);
    			
    			
    		}
    	})
    	
    	
    	
    	$('#route_show').dialog({
    		title:"查看路线信息",
    		iconCls:'icon-user-add',
    		
    	});
    	$('#route_show').dialog("open");
    }
</script>

